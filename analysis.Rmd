---
title: "Statistical Inference Course Project"
author: "Marko Intihar"
date: "11/26/2020"
output: pdf_document
---

```{r setoptions, echo=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, fig.width = 6, fig.height = 4)
```

```{r firststep, message=FALSE, echo=FALSE}
rm(list = ls())
graphics.off()

# Load R packages
packages <- c("dplyr", "ggplot2") # list of packages to load

package.check <- lapply( # load or install & load list of packages
  packages,
  FUN = function(x) {
    if (!require(x, character.only = TRUE)) {
      install.packages(x, dependencies = TRUE)
      library(x, character.only = TRUE)
    }
  }
) 
rm(packages, package.check)

```

# Part 1: Simulation

We are investigating exponential distribution and we are comparing it with the Central Limit Theorem (CLT). Random variable $X$ follows exponential distribution $exp(\lambda)$, where parameter $lambda$ is rate parameter. The probability densitiy function (PDF) of exponentila distribution is:

$$
f(x) = 
\begin{cases}
\lambda \cdot e^{-\lambda \cdot x}\, ,& x\geq 0 \\
0\, ,&x < 0
\end{cases}
$$

From the theory we know that mean or expected value of exponential distribution is $E[X]=\lambda$ and variance is $Var[X]=\frac{1}{\lambda}$.

In our simulation we will do the following:

* simulate random samples from exponential distribution (where $\lambda = 0.2$)
* each random sample will include $n=20$ random numbers
* we will generate $B=1000$ different random samples

After the simulations we would like to put CLT to the test by:

1. Comparing sample mean to the theoretical mean of the distribution.
2. Showing how variable the sample is (via variance) and comparing it to the theoretical variance of the distribution.
3. Showing that the distribution is approximately normal.

Let's simulate our samples:

```{r simulation}
set.seed(11235)
lambda <- 0.2 # lambda of population distribution
n <- 20 # sample size
B <- 1000 # samples generated in simulation
samples <- matrix(rexp(n = n * B, rate = lambda),  # generate samples - save to matrix
                  nrow = B, ncol = n)
```

Draw histogram of sample means VS theoretical mean of distribution:

```{r samplemeans}
sample.means <- apply(samples, 1, mean) %>% # calculate sample means
  data.frame(X.bar = .)

# draw histogram sample means VS theoretical distribution mean
sample.means %>% 
  ggplot(aes(x = X.bar)) +
  geom_histogram(color = "black") +
  geom_vline(xintercept = 1/lambda, color = "red", size = 1.5) +
  geom_vline(xintercept = mean(sample.means$X.bar), color = "blue", size = 1.5) +
  scale_x_continuous(breaks = seq(0,10)) +
  xlab("Sample means X(bar) (~lambda estimates)") +
  ylab("Number of samples") +
  ggtitle("Histogram of sample means VS true population mean (red line)")

```

Now check what is the variability of sample means, based on the theory (CLT) the variability (variance of distribution) of sample means should be close to $SE^2=\frac{\sigma^2}{n}$, where $SE$ is standard error, $\sigma^2$ is variance of population distribution (exponential distribution: $\frac{1}{\lambda}=\frac{1}{0.2}=5$). Using samples we can estimate standard error $SE^2=\frac{\s^2}{n}$, where $s^2$ is estimated variance from sample. 

```{r SE}
sample.var <- apply(samples, 1, var) %>% # calculate sample variance
  data.frame(s2.bar = .) %>% 
  mutate(SE2 = s2.bar / n)

# draw histogram sample means VS theoretical distribution mean
sample.var %>% 
  ggplot(aes(x = SE2)) +
  geom_histogram(color = "black") +
  geom_vline(xintercept = (1/lambda^2)/n, color = "red", size = 1.5) +
  geom_vline(xintercept = mean(sample.var$SE2), color = "blue", size = 1.5) +
  scale_x_continuous(breaks = seq(0,10, 0.5)) +
  xlab("Variability of sample means (SE^2)") +
  ylab("Number of samples") +
  ggtitle("")

```




# Part 2: Inferential Data Analysis